[gd_scene load_steps=5 format=2]

[ext_resource path="res://sprites/deprese.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends KinematicBody2D

#VARIABLES
var velocity = Vector2()

export (int) var speed_x = 50
export (int) var speed_y = 50

var direction

var poloha_x = 1 
var poloha_y =1

var timer = null
var wait = false
export (int) var delay = 2
var locktarget = false


func _physics_process(delta):
	
	#VIEW SYSTEM
	if Input.is_action_just_pressed(\"E\")&& self.visible == true:
		self.visible = false
	else:
		if Input.is_action_just_pressed(\"E\")&& self.visible == false:
			self.visible = true
			
	if Input.is_action_just_pressed(\"ui_left\"):
		self.visible = true
	if Input.is_action_just_pressed(\"ui_right\"):
		self.visible = true
	if Input.is_action_just_pressed(\"ui_select\"):
		self.visible = true
	if Input.is_action_just_pressed(\"ui_down\"):
		self.visible = true
	if Input.is_action_just_pressed(\"ui_up\"):
		self.visible = true
	
	
	#TARGETING SYSTEM
	var player = $\"../Player\"

	if abs(stepify(position.x, 1) - stepify(poloha_x, 1)) <= 5 and abs(stepify(position.y, 1) - stepify(poloha_y, 1)) <= 5 or direction == null:
		timer.start()
		wait = true
		direction = global_position.direction_to(player.global_position)
		poloha_x = player.position.x
		poloha_y = player.position.y
	
	
	
	if locktarget == true:
		direction = global_position.direction_to(player.global_position)
		poloha_x = player.position.x
		poloha_y = player.position.y
		locktarget = false
	
	#MOVEMENT SYSTEM
	if wait == false:
		velocity = velocity.move_toward(direction * speed_x, speed_y)
		move_and_slide(velocity)
	
	
#TIMER
func _ready():
	timer = Timer.new()
	timer.set_one_shot(true)
	timer.set_wait_time(delay)
	timer.connect(\"timeout\", self, \"on_timeout_complete\")
	add_child(timer)
	
func on_timeout_complete():
	wait = false
	locktarget = true
	


func _on_Area2D_body_entered(body):
	if body.get(\"TYPE\")== \"player\":
		 get_tree().reload_current_scene()
"

[sub_resource type="RectangleShape2D" id=2]

[sub_resource type="CircleShape2D" id=3]
radius = 45.3964

[node name="depression" type="KinematicBody2D"]
position = Vector2( -177.298, 9.51364 )
script = SubResource( 1 )

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( 3.47314, 0.223419 )
scale = Vector2( 0.306509, 0.306509 )
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( -4.75684, -1.18924 )
shape = SubResource( 2 )
disabled = true

[node name="Area2D" type="Area2D" parent="."]
position = Vector2( -3.56757, -3.56766 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Area2D"]
position = Vector2( 3.56763, 1.18921 )
shape = SubResource( 3 )
[connection signal="body_entered" from="Area2D" to="." method="_on_Area2D_body_entered"]
